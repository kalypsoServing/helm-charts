opentelemetry-operator:
  enabled: true
  manager:
    collectorImage:
      repository: otel/opentelemetry-collector-contrib
  admissionWebhooks:
    certManager:
      enabled: true

# OpenTelemetry eBPF Instrumentation (DaemonSet)
# Collects traces/metrics from all pods on each node using eBPF
opentelemetry-ebpf-instrumentation:
  enabled: true
  
  # 최소 권한 모드 (커널 5.8+ 필요)
  privileged: false
  extraCapabilities:
    - BPF
    - PERFMON
    - SYS_PTRACE
    - DAC_READ_SEARCH
    - CHECKPOINT_RESTORE
  
  # application: traces/metrics, network: network flows
  preset: application
  
  rbac:
    create: true
  
  config:
    create: true
    data:
      otel_traces_export:
        endpoint: "http://kalypso-otel-collector.otel-system.svc.cluster.local:4317"
      otel_metrics_export:
        endpoint: "http://kalypso-otel-collector.otel-system.svc.cluster.local:4318/v1/metrics"
      attributes:
        kubernetes:
          enable: true
      prometheus_export:
        port: 9090
        path: /metrics

clusterName: kalypso

# OpenTelemetry Collector (Deployment via Operator CR)
otelCollector:
  enabled: true
  replicas: 1
  memoryLimitMiB: 512
  spikeLimitMiB: 128
  resources:
    requests:
      cpu: 200m
      memory: 256Mi
    limits:
      cpu: 1000m
      memory: 1Gi
  podDisruptionBudget:
    minAvailable: 1

# Backend endpoints
endpoints:
  mimir: http://kalypso-mimir-nginx.mimir.svc.cluster.local:80/otlp
  tempo: kalypso-tempo-distributor.tempo.svc.cluster.local:4317
  loki: http://kalypso-loki-gateway.loki.svc.cluster.local:80/loki/api/v1/push
  pyroscope: http://kalypso-pyroscope.pyroscope.svc.cluster.local:4040
